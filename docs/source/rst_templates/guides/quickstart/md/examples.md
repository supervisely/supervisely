
## Getting a project from an existing one with image transformation

    import supervisely_lib as sly
    #Import functions to preprocess images and annotations together
    from supervisely_lib.aug.aug import resize, fliplr
    
    WORKSPACE_ID = 23821
    PROJECT_ID = 98674
    dst_project_name = 'example_project'
    
    #Initialize API object
    address = 'https://app.supervise.ly'
    token = 'P78DuO37grwKNbGikDso72gphdCICDsiTXflvSGVEiendUhnJz93Pm48KKPAlgh2k68TPIAR7LPW1etGPiATM1ZOQL8iFVfWjt8gUphxps3IOSicrm6m0gv2cQh3lfww'
    api = sly.Api(address, token)
    
    #Get information about project
    src_project = api.project.get_info_by_id(PROJECT_ID)
    if src_project is None:
        raise RuntimeError("Project with id={!r} not found".format(PROJECT_ID))
    #Get project meta
    meta_json = api.project.get_meta(PROJECT_ID)
    meta = sly.ProjectMeta.from_json(meta_json)
    #Create new project
    dst_project = api.project.create(WORKSPACE_ID, dst_project_name, change_name_if_conflict=True)
    if dst_project.name != dst_project_name:
        sly.logger.warn("Project with name={!r} already exists. Project is saved with autogenerated name {!r}".format(dst_project_name, dst_project.name))
    #Upload meta to new project
    api.project.update_meta(dst_project.id, meta.to_json())
    #Go through datasets in project
    for src_dataset in api.dataset.get_list(src_project.id):
        #Create new dataset in new project
        dst_dataset = api.dataset.create(dst_project.id, src_dataset.name)
        #Get list of images info from current dataset
        images = api.image.get_list(src_dataset.id)
        #Go through images batch(by default batch=50)
        for batch in sly.batched(images):
            image_ids = [image_info.id for image_info in batch]
            image_names = [image_info.name for image_info in batch]
            #Get ann infos from images ids
            ann_infos = api.annotation.download_batch(src_dataset.id, image_ids)
            #Download images
            images = api.image.download_nps(src_dataset.id, image_ids)
            new_images = []
            new_anns = []
            #Go through images and annotations to preprocess them
            for ann_info, image, image_name in zip(ann_infos, images, image_names):
                #Get annotation
                ann = sly.Annotation.from_json(ann_info.annotation, meta)
                #Old image and annotation size
                print(ann.img_size)
                resize_image, resize_ann = resize(image, ann, (500, 600))
                new_image, new_ann = fliplr(resize_image, resize_ann)
                #New image and annotation size
                print(new_ann.img_size)
                new_images.append(new_image)
                new_anns.append(new_ann)
            #Upload new images to new dataset on API
            dst_image_infos = api.image.upload_nps(dst_dataset.id, image_names, new_images)
            #Get new images ID
            dst_image_ids = [img_info.id for img_info in dst_image_infos]
            #Upload new annotations by new images IDs on API
            api.annotation.upload_anns(dst_image_ids, new_anns)

One of images with annotation before transformation:

![](https://i.imgur.com/ZMKwjfR.jpg)

    (800, 1067)

One of images with annotation after transformation:

![](https://i.imgur.com/s8rq3xF.jpg)

    (500, 600)

## Sliding windows example

    import supervisely_lib as sly
    #Import SlidingWindowsFuzzy class to sliding images and annotations
    from supervisely_lib.geometry.sliding_windows_fuzzy import SlidingWindowsFuzzy
    WORKSPACE_ID = 23821
    PROJECT_ID = 98674
    IMAGE_ID = 176024255
    dst_project_name = 'sliding_image'
    dst_dataset_name = 'ds1'
    #Get params for sliding window
    window_height = 700
    window_width = 650
    overlap_y = 10
    overlap_x = 15
    SW_BORDER_STRATEGY = 'shift_window'
    #Initialize API object
    address = 'https://app.supervise.ly'
    token = 'P78DuO37grwKNbGikDso72gphdCICDsiTXflvSGVEiendUhnJz93Pm48KKPAlgh2k68TPIAR7LPW1etGPiATM1ZOQL8iFVfWjt8gUphxps3IOSicrm6m0gv2cQh3lfww'
    api = sly.Api(address, token)
    #Get information about project
    src_project = api.project.get_info_by_id(PROJECT_ID)
    if src_project is None:
        raise RuntimeError("Project with id={!r} not found".format(PROJECT_ID))
    #Get project meta
    meta_json = api.project.get_meta(PROJECT_ID)
    meta = sly.ProjectMeta.from_json(meta_json)
    #Create new project
    dst_project = api.project.create(WORKSPACE_ID, dst_project_name, change_name_if_conflict=True)
    if dst_project.name != dst_project_name:
        sly.logger.warn("Project with name={!r} already exists. Project is saved with autogenerated name {!r}".format(dst_project_name, dst_project.name))
    #Upload meta to new project
    api.project.update_meta(dst_project.id, meta.to_json())
    #Create new dataset
    dst_dataset = api.dataset.create(dst_project.id, dst_dataset_name)
    #Get image info
    image_info = api.image.get_info_by_id(IMAGE_ID)
    image_name = image_info.name
    #Download image from API
    image = api.image.download_np(IMAGE_ID)
    #Download annotation from API
    ann_info = api.annotation.download(IMAGE_ID)
    ann = sly.Annotation.from_json(ann_info.annotation, meta)
    crop_names = []
    crop_images = []
    crop_anns = []
    #Create slider object to sliding image and annotation
    slider = SlidingWindowsFuzzy([window_height, window_width], [overlap_y, overlap_x], SW_BORDER_STRATEGY)
    for window_index, window in enumerate(slider.get(image.shape[:2])):
        crop_name = "{}___{:04d}_{}_{}{}".format(sly.fs.get_file_name(image_name), window_index, window.top, window.left, sly.fs.get_file_ext(image_name))
        crop_names.append(crop_name)
        #Crop image and annotation with sliding window
        crop_ann = ann.relative_crop(window)
        crop_anns.append(crop_ann)
        crop_image = sly.image.crop(image, window)
        crop_images.append(crop_image)
    #Upload new image to new dataset on API
    dst_image_infos = api.image.upload_nps(dst_dataset.id, crop_names, crop_images)
    #Get new images ID
    dst_image_ids = [img_info.id for img_info in dst_image_infos]
    #Upload new annotation by new image ID on API
    api.annotation.upload_anns(dst_image_ids, crop_anns)

Image with annotation before transformation:

![](https://i.imgur.com/ZMKwjfR.jpg)

    (800, 1067)

Result images with annotations:

![](https://i.imgur.com/9dbyxDB.jpg)

    (700, 650)

![](https://i.imgur.com/VpCcuK6.jpg)

    (700, 650)

![](https://i.imgur.com/5JoWBLM.jpg)

    (700, 650)

![](https://i.imgur.com/vuDAXzx.jpg)

    (700, 650)

## Geometry convertation

    import supervisely_lib as sly
    WORKSPACE_ID = 23821
    PROJECT_ID = 98674
    dst_project_name = 'rectangle_project'
    #Initialize API object
    address = 'https://app.supervise.ly'
    token = 'P78DuO37grwKNbGikDso72gphdCICDsiTXflvSGVEiendUhnJz93Pm48KKPAlgh2k68TPIAR7LPW1etGPiATM1ZOQL8iFVfWjt8gUphxps3IOSicrm6m0gv2cQh3lfww'
    api = sly.Api(address, token)
    #Get information about project
    src_project = api.project.get_info_by_id(PROJECT_ID)
    if src_project is None:
        raise RuntimeError("Project with id={!r} not found".format(PROJECT_ID))
    #Get project meta
    meta_json = api.project.get_meta(PROJECT_ID)
    meta = sly.ProjectMeta.from_json(meta_json)
    #Create new project
    dst_project = api.project.create(WORKSPACE_ID, dst_project_name, change_name_if_conflict=True)
    if dst_project.name != dst_project_name:
        sly.logger.warn("Project with name={!r} already exists. Project is saved with autogenerated name {!r}".format(dst_project_name, dst_project.name))
    #Create new project meta
    new_obj_classes = []
    for obj_class in meta.obj_classes:
        new_obj_classes.append(obj_class.clone(geometry_type=sly.Rectangle))
    new_meta = meta.clone(obj_classes=sly.ObjClassCollection(new_obj_classes))
    #Upload new meta to new project
    api.project.update_meta(dst_project.id, new_meta.to_json())
    #Go through datasets in project
    for src_dataset in api.dataset.get_list(src_project.id):
        #Create new dataset in new project
        dst_dataset = api.dataset.create(dst_project.id, src_dataset.name)
        #Get list of images info from current dataset
        images = api.image.get_list(src_dataset.id)
        #Go through images batch(by default batch=50)
        for batch in sly.batched(images):
            image_ids = [image_info.id for image_info in batch]
            #Get ann infos from images ids
            ann_infos = api.annotation.download_batch(src_dataset.id, image_ids)
            new_anns = []
            #Go through annotations to preprocess them
            for ann_info in ann_infos:
                new_labels = []
                #Get annotation
                ann = sly.Annotation.from_json(ann_info.annotation, meta)
                #Go through annotation labels to preprocess them
                for label in ann.labels:
                    #Convert label geomerty
                    rectangle_labels = label.convert(sly.ObjClass(label.obj_class.name, sly.Rectangle))
                    #Go through geomerties(my be more then one geomerty after convertation)
                    for rectangle_label in rectangle_labels:
                        new_labels.append(rectangle_label)
                #Create new annotation
                new_ann = ann.clone(labels=new_labels)
                new_anns.append(new_ann)
            #Copy new images to new dataset on API
            dst_image_infos = api.image.copy_batch(dst_dataset.id, image_ids)
            #Get new images ID
            dst_image_ids = [img_info.id for img_info in dst_image_infos]
            #Upload new annotations by new images IDs on API
            api.annotation.upload_anns(dst_image_ids, new_anns)

One of images with annotation before geometry convertation:

![](https://i.imgur.com/ZMKwjfR.jpg)

One of images with annotation after geometry convertation:

![](https://i.imgur.com/EDiYz8L.jpg)
