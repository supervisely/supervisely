<link rel="stylesheet" href="./sly/css/app/widgets/selectable_fast_table/style.css" />

<selectable-fast-table 
  style="width: {{{widget._width}}}"
  :page.sync="state.{{{widget.widget_id}}}.page"
  :total="data.{{{widget.widget_id}}}.total"
  :page-size="data.{{{widget.widget_id}}}.pageSize"
  :options="data.{{{widget.widget_id}}}.options"
  :columns="data.{{{widget.widget_id}}}.columns"
  :columns-options="data.{{{widget.widget_id}}}.columnsOptions"
  :project-meta="data.{{{widget.widget_id}}}.projectMeta"
  :sort.sync="state.{{{widget.widget_id}}}.sort"
  :search.sync="state.{{{widget.widget_id}}}.search"
  :data="data.{{{widget.widget_id}}}.data"
  :show-header="data.{{{widget.widget_id}}}.showHeader"
  :selected-rows="state.{{{widget.widget_id}}}.selectedRows"
  :selected-idxs="state.{{{widget.widget_id}}}.selectedRows ? state.{{{widget.widget_id}}}.selectedRows.map(row => row.idx) : []"
  :selected-radio-idx="state.{{{widget.widget_id}}}.selectedRows && state.{{{widget.widget_id}}}.selectedRows.length > 0 ? state.{{{widget.widget_id}}}.selectedRows[0].idx : null"
  :disabled="data.{{{widget.widget_id}}}.disabled"
  @update:selected-rows="(rows) => {
    state.{{{widget.widget_id}}}.selectedRows = rows;
    data.{{{widget.widget_id}}}.selectionChangedHandled && post('/{{{widget.widget_id}}}/selection_changed_cb');
  }"
  {%
  if
  widget._row_click_handled
  %}
  @row-click="state.{{{widget.widget_id}}}.selectedRow = $event; post('/{{{widget.widget_id}}}/row_clicked_cb')"
  {%
  endif
  %}
  {%
  if
  widget._cell_click_handled
  %}
  @cell-click="state.{{{widget.widget_id}}}.selectedCell = $event; post('/{{{widget.widget_id}}}/cell_clicked_cb')"
  {%
  endif
  %}
  @filters-changed="state.reactToChanges = false; post('/{{{widget.widget_id}}}/update_data_cb');"
>
  {% if widget._header_left_content %}
  <span slot="header-left-side-start" class="header-left-side-start-cls">
    <div style="display: flex; align-items: center; gap: 12px; padding-left: 8px; padding-right: 16px;">
      {{{ widget._header_left_content }}}
    </div>
  </span>
  {% endif %}
  <span slot="cell-content" slot-scope="{ row, column, cellValue, idx }">
    {% for row_idx, special_data in widget._row_special_data.items() %}
    <div v-if="row.idx === {{{ row_idx }}} && column === '{{{ widget._columns_first_idx[0] if widget._columns_first_idx else '' }}}'">
      {% if special_data and ('http' in special_data) and ('.png' in special_data or '.jpg' in special_data or '.jpeg' in special_data or '.gif' in special_data) %}
      <div style="display: flex; align-items: center; gap: 10px; padding: 8px;">
        <img src="{{{ special_data }}}" alt="Row image"
          style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;"
          onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
        <div
          style="display: none; width: 60px; height: 60px; background-color: #f5f5f5; border: 2px dashed #ccc; border-radius: 8px; align-items: center; justify-content: center; font-size: 24px; color: #999;">
          🖼️
        </div>
        <div style="font-weight: 500;">{{ cellValue }}</div>
      </div>
      {% elif special_data and ('http' in special_data) %}
      <div style="display: flex; align-items: center; gap: 10px; padding: 8px;">
        <div
          style="width: 60px; height: 60px; background-color: #f5f5f5; border: 2px dashed #ccc; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #999;">
          📦
        </div>
        <div>
          <div style="font-weight: 500;">{{ cellValue }}</div>
        </div>
      </div>
      {% else %}
      <div style="display: flex; align-items: center; gap: 8px; padding: 6px;">
        <span style="font-size: 20px;">✨</span>
        <div>
          <div style="font-weight: 500;">{{ cellValue }}</div>
          <div style="font-size: 12px; color: #666;">{{{ special_data }}}</div>
        </div>
      </div>
      {% endif %}
    </div>
    {% endfor %}
    
    {% for column_data in widget._columns_data %}
    {% if column_data.is_widget %}
    <div 
      v-if="column === '{{{ column_data.name }}}'{% if widget._row_special_data %} && !{% for row_idx in widget._row_special_data.keys() %}(row.idx === {{{ row_idx }}}){% if not loop.last %} && !{% endif %}{% endfor %}{% endif %}"
      :class="data.{{{widget.widget_id}}}.columnsOptions?.[{{{ loop.index0 }}}]?.classes || ''"
      :style="data.{{{widget.widget_id}}}.columnsOptions?.[{{{ loop.index0 }}}]?.style || ''"
      @click.native.stop
    >
      <span v-html="cellValue"></span>
    </div>
    {% else %}
    <div
      v-if="column === '{{{ column_data.name }}}'{% if widget._row_special_data %} && !{% for row_idx in widget._row_special_data.keys() %}(row.idx === {{{ row_idx }}}){% if not loop.last %} && !{% endif %}{% endfor %}{% endif %}">
      <span v-html="cellValue"></span>
    </div>
    {% endif %}
    {% endfor %}
  </span>

</selectable-fast-table>